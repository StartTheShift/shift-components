{"version":3,"sources":["shift-components.js"],"names":["angular","module","directive","restrict","scope","source","query","link","templateUrl","date","dateChange","dateValidator","dateHightlight","dateAllowNull","buildCalendarScope","isValidDate","updateDate","goToNextMonth","showing_date","add","goToPreviousMonth","subtract","goToSelectedDate","moment","selectDate","$event","target","getAttribute","setNull","isMoment","isValid","$watch","new_value","old_value","getClass","ref","active","isSame","off","available","invalid","highlight","day_of_the_month","day_of_the_week","end_date","results","week","startOf","endOf","weeks","day","length","push","iso_8061","format","run","$templateCache","put","indexOf","item","i","l","this","shiftSortable","shiftSortableChange","shiftSortableHandle","element","attrs","container","dragging","getElementAt","grab","hovered_element","isBefore","isInside","last_element","move","placeholder","release","start_position","document","createElement","className","x","y","coord","index","last","len","children","getBoundingClientRect","rectange","rel_x","rel_y","$","window","scrollTop","scrollLeft","left","top","height","width","right","bottom","event","preventDefault","matches","parentElement","call","style","clientWidth","clientHeight","minWidth","minHeight","addEventListener","insertBefore","body","appendChild","addClass","elt","pageX","pageY","end_position","removeClass","removeChild","removeEventListener","$apply","record","splice","hasProp","hasOwnProperty","$compile","$filter","$timeout","template","options","filter","selected","onSelect","DOWN_KEY","ENTER_KEY","UP_KEY","filterOptions","onKeyDown","startListening","stopListening","position","display","option","city","filtered_options","key_code","which","keyCode","select","Math","max","min","stopPropagation","key","$on"],"mappings":"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","file":"shift-components.min.js","sourcesContent":["\n/**\nUI components for SHIFT applications\n\n@requires momentJS\n@requires lodash\n@requires jQuery\n@requires shift.components.sortable\n@requires shift.components.calendar\n@requires shift.components.select\n\n@module shift.components\n\n@link sortable/\n */\nangular.module('shift.components', ['shift.components.sortable', 'shift.components.calendar', 'shift.components.select']);\n\n\n/**\nAn autocomplete directive to suggest matching object as you type\n */\nangular.module('shift.components.autocomplete', []).directive('shiftAutocomplete', [\n  function() {\n    return {\n      restrict: 'E',\n      scope: {\n        source: '=',\n        query: '='\n      },\n      link: function(scope) {\n        return void 0;\n      }\n    };\n  }\n]);\n\n\n/**\nCalendar directive displays the date and changes it on click.\n\nNote that moment(moment_object) is heavily used to clone a date instead of\njust passing the reference (since date is a moment object). It allows simpler\ndate handeling without the the risk of impacting associated dates.\n\n@module shift.components.calendar\n\n@requires momentJS\n@requires lodash\n\n@param {moment} date A moment object, default to now\n@param {function} dateChange Called when date is changed\n@param {function} dateValidator Method returning a Boolean indicating if\nthe selected date is valid or not\n@param {function} dateHightlight Method returning a Boolean to highlight\na days on the calendar.\n@param {Boolean} dateAllowNull Indicate if the date can be set to null\n\n@example\n```jade\nshift-calendar(\n  date = \"date\"\n  date-change = \"onDateChange(date)\"\n  date-validator = \"isValidDate\"\n  date-highlight = \"isSpecialDay\"\n  date-allow-null = \"true\"\n)\n```\n */\nangular.module('shift.components.calendar', []).directive('shiftCalendar', [\n  function() {\n    return {\n      restrict: 'E',\n      templateUrl: 'calendar/calendar.html',\n      scope: {\n        date: '=',\n        dateChange: '&',\n        dateValidator: '=',\n        dateHightlight: '=',\n        dateAllowNull: '='\n      },\n      link: function(scope) {\n        var buildCalendarScope, isValidDate, updateDate;\n        scope.goToNextMonth = function() {\n          scope.showing_date.add(1, 'month');\n          return buildCalendarScope();\n        };\n        scope.goToPreviousMonth = function() {\n          scope.showing_date.subtract(1, 'month');\n          return buildCalendarScope();\n        };\n        scope.goToSelectedDate = function() {\n          scope.showing_date = moment(scope.date);\n          return buildCalendarScope();\n        };\n        scope.selectDate = function($event) {\n          return updateDate(moment($event.target.getAttribute('data-iso')));\n        };\n        scope.setNull = function() {\n          if (!scope.dateAllowNull) {\n            return;\n          }\n          scope.date = null;\n          buildCalendarScope();\n          return scope.dateChange();\n        };\n        isValidDate = function(date) {\n          if (!(moment.isMoment(date) && date.isValid())) {\n            return false;\n          }\n          if (scope.dateValidator != null) {\n            return scope.dateValidator(date);\n          }\n          return true;\n        };\n        updateDate = function(date) {\n          if (isValidDate(date)) {\n            scope.date = date;\n            scope.showing_date = moment(date);\n            buildCalendarScope();\n            return scope.dateChange();\n          }\n        };\n        scope.$watch('date', function(new_value, old_value) {\n          if (new_value === old_value) {\n            return;\n          }\n          return updateDate(new_value);\n        });\n        scope.getClass = function(date) {\n          var ref;\n          return {\n            active: (ref = scope.date) != null ? ref.isSame(date, 'day') : void 0,\n            off: !scope.showing_date.isSame(date, 'month'),\n            available: isValidDate(date),\n            invalid: !isValidDate(date),\n            highlight: typeof scope.dateHightlight === \"function\" ? scope.dateHightlight(date) : void 0\n          };\n        };\n        (buildCalendarScope = function() {\n          var date, day_of_the_month, day_of_the_week, end_date, results, week;\n          date = moment(scope.showing_date).startOf('month').startOf('week');\n          end_date = moment(scope.showing_date).endOf('month').endOf('week');\n          scope.weeks = [];\n          results = [];\n          while (true) {\n            day_of_the_week = date.day();\n            day_of_the_month = date.date();\n            if (day_of_the_week === 0) {\n              if (scope.weeks.length > 5) {\n                break;\n              }\n              week = [];\n              scope.weeks.push(week);\n            }\n            week.push({\n              iso_8061: date.format(),\n              day_of_the_month: day_of_the_month,\n              date: moment(date)\n            });\n            results.push(date.add(1, 'day'));\n          }\n          return results;\n        })();\n        if (!scope.dateAllowNull && !moment.isMoment(scope.date)) {\n          scope.date = moment();\n        }\n        if (moment.isMoment(scope.date)) {\n          updateDate(scope.date);\n          return scope.showing_date = moment(scope.date);\n        } else {\n          return scope.showing_date = moment().startOf('day');\n        }\n      }\n    };\n  }\n]);\n\n'use strict';\n\nangular.module('shift.components.calendar').run(['$templateCache', function($templateCache) {\n\n  $templateCache.put('calendar/calendar.html', '<div class=\"calendar\"><table class=\"table-condensed\"><thead><tr><th title=\"previous month\" ng-click=\"goToPreviousMonth()\"><i class=\"fa fa-chevron-left\"></i></th><th><i ng-if=\"date\" title=\"go to {{ date.format(\\'MMMM Do, YYYY\\') }}\" ng-hide=\"showing_date.isSame(date, \\'month\\')\" ng-click=\"goToSelectedDate()\" class=\"fa fa-dot-circle-o\"></i></th><th colspan=\"3\" class=\"month\">{{ showing_date.format(\\'MMM YYYY\\') }}</th><th><i title=\"Unset date\" ng-click=\"setNull()\" ng-if=\"date &amp;&amp; dateAllowNull\" class=\"fa fa-times\"></i></th><th title=\"next month\" ng-click=\"goToNextMonth()\"><i class=\"fa fa-chevron-right\"></i></th></tr><tr><th>Su</th><th>Mo</th><th>Tu</th><th>We</th><th>Th</th><th>Fr</th><th>Sa</th></tr></thead><tbody ng-click=\"selectDate($event)\"><tr ng-repeat=\"week in weeks track by $index\"><td ng-repeat=\"day in week track by $index\" ng-class=\"getClass(day.date)\" data-iso=\"{{ day.iso_8061 }}\">{{ day.day_of_the_month }}</td></tr></tbody></table></div>');\n\n}]);\n\n/**\nSortable directive to allow drag n' drop sorting of an array.\n\n@module shift.components.sortable\n\n@requires momentJS\n@requires lodash\n\n@param {array} shiftSortable Array of sortable object\n@param {function} shiftSortableChange Called when order is changed\n@param {string} shiftSortableHandle CSS selector to grab the element (optional)\n\n@example\n```jade\nul(\n  shift-sortable = \"list_of_object\"\n  shift-sortable-change = \"onListOrderChange(list_of_object)\"\n  shift-sortable-handle = \".grab-icon\"\n)\n  li(ng-repeat = \"element in list_of_object\") {{ element.name }}\n```\n */\nvar indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\nangular.module('shift.components.sortable', []).directive('shiftSortable', function() {\n  return {\n    restrict: 'A',\n    scope: {\n      shiftSortable: '=',\n      shiftSortableChange: '&',\n      shiftSortableHandle: '@'\n    },\n    link: function(scope, element, attrs) {\n      var container, dragging, getElementAt, grab, hovered_element, isBefore, isInside, last_element, move, placeholder, release, start_position;\n      container = element[0];\n      dragging = null;\n      start_position = null;\n      hovered_element = null;\n      last_element = {};\n      placeholder = document.createElement('div');\n      placeholder.className = 'placeholder';\n      getElementAt = function(x, y) {\n        var coord, i, index, last, len, ref;\n        last = container.children[container.children.length - 1];\n        ref = container.children;\n        for (index = i = 0, len = ref.length; i < len; index = ++i) {\n          element = ref[index];\n          coord = element.getBoundingClientRect();\n          if (isInside(x, y, coord)) {\n            if (isBefore(x, y, coord)) {\n              return element;\n            } else if (element === last) {\n              return last_element;\n            } else {\n              return container.children[index + 1];\n            }\n          }\n        }\n      };\n      isBefore = function(x, y, rectange) {\n        var rel_x, rel_y;\n        y -= $(window).scrollTop();\n        x -= $(window).scrollLeft();\n        rel_x = x - rectange.left;\n        rel_y = rectange.top + rectange.height - y;\n        return rel_y > (rel_x / rectange.width) * rectange.height;\n      };\n      isInside = function(x, y, rectange) {\n        y -= $(window).scrollTop();\n        x -= $(window).scrollLeft();\n        return x > rectange.left && x < rectange.right && y > rectange.top && y < rectange.bottom;\n      };\n      grab = function(event) {\n        var target;\n        event.preventDefault();\n        target = event.target;\n        if (scope.shiftSortableHandle != null) {\n          if (!target.matches(scope.shiftSortableHandle)) {\n            return;\n          }\n          while (target.parentElement !== container) {\n            target = target.parentElement;\n          }\n        }\n        if (indexOf.call(container.children, target) >= 0) {\n          dragging = target;\n          start_position = $(dragging).index();\n          placeholder.style.width = dragging.clientWidth + \"px\";\n          placeholder.style.height = dragging.clientHeight + \"px\";\n          dragging.style.minWidth = ($(dragging).width()) + \"px\";\n          dragging.style.minHeight = ($(dragging).height()) + \"px\";\n          window.addEventListener('mousemove', move);\n          window.addEventListener('mouseup', release);\n          container.insertBefore(placeholder, dragging);\n          document.body.appendChild(dragging);\n          $(dragging).addClass('dragging');\n          move(event);\n        }\n        return false;\n      };\n      move = function(event) {\n        var elt;\n        event.preventDefault();\n        dragging.style.left = (event.pageX - 10) + \"px\";\n        dragging.style.top = (event.pageY - 10) + \"px\";\n        if (!isInside(event.pageX, event.pageY, container.getBoundingClientRect())) {\n          return false;\n        }\n        elt = getElementAt(event.pageX, event.pageY);\n        if (elt != null) {\n          if (elt === last_element) {\n            container.appendChild(placeholder);\n          } else if (elt !== hovered_element) {\n            hovered_element = elt;\n            container.insertBefore(placeholder, elt);\n          }\n        }\n        return false;\n      };\n      release = function(event) {\n        var end_position;\n        end_position = $(placeholder).index();\n        $(dragging).removeClass('dragging');\n        container.insertBefore(dragging, placeholder);\n        container.removeChild(placeholder);\n        dragging.style.left = placeholder.style.width = dragging.style.minWidth = '';\n        dragging.style.top = placeholder.style.height = dragging.style.minHeight = '';\n        dragging = null;\n        window.removeEventListener('mousemove', move);\n        window.removeEventListener('mouseup', release);\n        if (end_position !== start_position) {\n          return scope.$apply(function() {\n            var record;\n            record = scope.shiftSortable.splice(start_position, 1)[0];\n            scope.shiftSortable.splice(end_position, 0, record);\n            return scope.shiftSortableChange();\n          });\n        }\n      };\n      return container.addEventListener('mousedown', grab);\n    }\n  };\n});\n\n\n/**\nA directive that displays a list of option, navigation using arrow keys + enter or mouse click.\n */\nvar hasProp = {}.hasOwnProperty;\n\nangular.module('shift.components.select', []).directive('shiftSelect', [\n  '$compile', '$filter', '$timeout', function($compile, $filter, $timeout) {\n    return {\n      restrict: 'E',\n      templateUrl: 'select/select.html',\n      scope: {\n        template: '@',\n        options: '=',\n        filter: '=',\n        selected: '=',\n        onSelect: '&'\n      },\n      link: function(scope, element) {\n        var DOWN_KEY, ENTER_KEY, UP_KEY, filterOptions, onKeyDown, startListening, stopListening;\n        UP_KEY = 38;\n        DOWN_KEY = 40;\n        ENTER_KEY = 13;\n        scope.position = -1;\n        scope.display = function(option) {\n          return option.city;\n          return $compile(scope.template, option);\n        };\n        scope.$watch('filter', function(new_value, old_value) {\n          if (new_value === old_value) {\n            return;\n          }\n          scope.position = -1;\n          return filterOptions();\n        }, true);\n        (filterOptions = function() {\n          return scope.filtered_options = $filter('filter')(scope.options, scope.filter);\n        })();\n        onKeyDown = function(event) {\n          var key_code;\n          if (!scope.filtered_options.length) {\n            return;\n          }\n          key_code = event.which || event.keyCode;\n          if (key_code !== UP_KEY && key_code !== DOWN_KEY && key_code !== ENTER_KEY) {\n            return;\n          }\n          switch (key_code) {\n            case UP_KEY:\n              scope.position -= 1;\n              break;\n            case DOWN_KEY:\n              scope.position += 1;\n              break;\n            default:\n              if (scope.position > -1) {\n                scope.select(scope.position);\n              }\n          }\n          scope.position = Math.max(0, scope.position);\n          scope.position = Math.min(scope.filtered_options.length - 1, scope.position);\n          scope.$apply();\n          event.preventDefault();\n          event.stopPropagation();\n          return false;\n        };\n        scope.select = function(index) {\n          var key, ref;\n          scope.position = index;\n          scope.selected = scope.filtered_options[scope.position];\n          ref = scope.filter;\n          for (key in ref) {\n            if (!hasProp.call(ref, key)) continue;\n            scope.filter[key] = scope.selected[key];\n          }\n          return scope.onSelect();\n        };\n        scope.getClass = function(index) {\n          return {\n            'selected': index === scope.position\n          };\n        };\n        (startListening = function() {\n          return document.addEventListener('keydown', onKeyDown);\n        })();\n        stopListening = function() {\n          return document.removeEventListener('keydown', onKeyDown);\n        };\n        scope.$on('$destroy', stopListening);\n        return void 0;\n      }\n    };\n  }\n]);\n\n'use strict';\n\nangular.module('shift.components.select').run(['$templateCache', function($templateCache) {\n\n  $templateCache.put('select/select.html', '<div ng-if=\"filtered_options.length\" class=\"select-container\"><div ng-repeat=\"option in filtered_options\" ng-class=\"getClass($index)\" ng-click=\"select($index)\" class=\"select-option\">{{ display(option) }}</div></div>');\n\n}]);"],"sourceRoot":"/source/"}