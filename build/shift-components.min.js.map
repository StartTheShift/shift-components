{"version":3,"sources":["shift-components.js"],"names":["angular","module","directive","restrict","templateUrl","scope","date","dateChange","dateValidator","link","buildCalendarScope","isValidDate","updateDate","moment","isMoment","startOf","goToNextMonth","next_month","add","goToPreviousMonth","previous_month","subtract","selectDate","$event","event","target","getAttribute","isValid","$watch","new_value","old_value","day_of_the_month","day_of_the_week","end_date","week","weeks","endOf","day","push","iso_8061","format","is_off","month","is_active","is_valid","run","$templateCache","put","indexOf","item","i","l","this","length","shiftSortable","shiftSortableChange","element","attrs","container","dragging","getElementAt","grab","hovered_element","isAfterLastElement","isInsideContainer","move","placeholder","release","start_position","document","createElement","className","x","y","coord","len","ref","$","window","scrollTop","scrollLeft","children","getBoundingClientRect","left","right","top","bottom","x_offset","y_offset","preventDefault","call","index","style","width","clientWidth","height","clientHeight","minWidth","minHeight","addEventListener","insertBefore","body","appendChild","addClass","elt","pageX","pageY","end_position","removeClass","removeChild","removeEventListener","$apply","record","splice"],"mappings":"AAcAA,QAAQC,OAAO,oBAAqB,4BAA6B,8BAyBjED,QAAQC,OAAO,gCAAiCC,UAAU,iBACxD,WACE,OACEC,SAAU,IACVC,YAAa,yBACbC,OACEC,KAAM,IACNC,WAAY,IACZC,cAAe,KAEjBC,KAAM,SAASJ,GACb,GAAIK,GAAoBC,EAAaC,CAuCrC,OAtCKC,QAAOC,SAAST,EAAMC,OACzBM,EAAWC,SAASE,QAAQ,QAE9BV,EAAMW,cAAgB,WACpB,GAAIC,EAEJ,OADAA,GAAaJ,OAAOR,EAAMC,MAAMY,IAAI,EAAG,SAChCN,EAAWK,IAEpBZ,EAAMc,kBAAoB,WACxB,GAAIC,EAEJ,OADAA,GAAiBP,OAAOR,EAAMC,MAAMe,SAAS,EAAG,SACzCT,EAAWQ,IAEpBf,EAAMiB,WAAa,SAASC,GAC1B,MAAOX,GAAWC,OAAOW,MAAMC,OAAOC,aAAa,eAErDf,EAAc,SAASL,GACrB,MAAMO,QAAOC,SAASR,IAASA,EAAKqB,UAGT,MAAvBtB,EAAMG,cACDH,EAAMG,cAAcF,IAEtB,GALE,GAOXM,EAAa,SAASN,GACpB,MAAIK,GAAYL,IACdD,EAAMC,KAAOA,EACbI,IACOL,EAAME,cAHf,QAMFF,EAAMuB,OAAO,OAAQ,SAASC,EAAWC,GACvC,MAAID,KAAcC,EAGXpB,IAHP,UAKMA,EAAqB,WAC3B,GAAIJ,GAAMyB,EAAkBC,EAAiBC,EAAUC,CAKvD,KAJA7B,EAAM8B,SACN7B,EAAOO,OAAOR,EAAMC,MAAMS,QAAQ,SAASA,QAAQ,QACnDkB,EAAWpB,OAAOR,EAAMC,MAAM8B,MAAM,SAASA,MAAM,QACnD/B,EAAM8B,SACQF,EAAP3B,GACL0B,EAAkB1B,EAAK+B,MACvBN,EAAmBzB,EAAKA,OACA,IAApB0B,IACFE,KACA7B,EAAM8B,MAAMG,KAAKJ,IAEnBA,EAAKI,MACHC,SAAUjC,EAAKkC,SACfT,iBAAkBA,EAClBU,OAAQpC,EAAMC,KAAKoC,UAAYpC,EAAKoC,QACpCC,UAAWrC,EAAKkC,OAAO,gBAAkBnC,EAAMC,KAAKkC,OAAO,cAC3DI,SAAUjC,EAAYL,KAExBA,EAAKY,IAAI,EAAG,MAEd,OAAO,iBASjBlB,QAAQC,OAAO,6BAA6B4C,KAAK,iBAAkB,SAASC,GAE1EA,EAAeC,IAAI,yBAA0B,srBAwB/C,IAAIC,YAAaA,SAAW,SAASC,GAAQ,IAAK,GAAIC,GAAI,EAAGC,EAAIC,KAAKC,OAAYF,EAAJD,EAAOA,IAAO,GAAIA,IAAKE,OAAQA,KAAKF,KAAOD,EAAM,MAAOC,EAAK,OAAO,GAElJlD,SAAQC,OAAO,gCAAiCC,UAAU,gBAAiB,WACzE,OACEC,SAAU,IACVE,OACEiD,cAAe,IACfC,oBAAqB,KAEvB9C,KAAM,SAASJ,EAAOmD,EAASC,GAC7B,GAAIC,GAAWC,EAAUC,EAAcC,EAAMC,EAAiBC,EAAoBC,EAAmBC,EAAMC,EAAaC,EAASC,CAgGjI,OA/FAV,GAAYF,EAAQ,GACpBG,EAAW,KACXS,EAAiB,KACjBN,EAAkB,KAClBI,EAAcG,SAASC,cAAc,OACrCJ,EAAYK,UAAY,cACxBX,EAAe,SAASY,EAAGC,GACzB,GAAIC,GAAOxB,EAAGyB,EAAKC,CAInB,KAHAH,GAAKI,EAAEC,QAAQC,YACfP,GAAKK,EAAEC,QAAQE,aACfJ,EAAMlB,EAAUuB,SACX/B,EAAI,EAAGyB,EAAMC,EAAIvB,OAAYsB,EAAJzB,EAASA,IAGrC,GAFAM,EAAUoB,EAAI1B,GACdwB,EAAQlB,EAAQ0B,wBACZV,EAAIE,EAAMS,MAAQX,EAAIE,EAAMU,OAASX,EAAIC,EAAMW,KAAOZ,EAAIC,EAAMY,SAC7D9B,EAAQ9B,aAAa,wBACxB,MAAO8B,IAKfQ,EAAoB,SAASQ,EAAGC,GAC9B,GAAIC,EAIJ,OAHAD,IAAKI,EAAEC,QAAQC,YACfP,GAAKK,EAAEC,QAAQE,aACfN,EAAQhB,EAAUwB,wBACXV,EAAIE,EAAMS,MAAQX,EAAIE,EAAMU,OAASX,EAAIC,EAAMW,KAAOZ,EAAIC,EAAMY,QAEzEvB,EAAqB,SAASS,EAAGC,GAC/B,GAAIC,GAAOa,EAAUC,CAMrB,OALAf,IAAKI,EAAEC,QAAQC,YACfP,GAAKK,EAAEC,QAAQE,aACfN,EAAQhB,EAAUuB,SAASvB,EAAUuB,SAAS5B,OAAS,GAAG6B,wBAC1DK,EAAwC,IAA5Bb,EAAMU,MAAQV,EAAMS,MAChCK,EAAwC,IAA5Bd,EAAMY,OAASZ,EAAMW,KACzBb,EAAIE,EAAMU,MAAQG,GAAYd,EAAIC,EAAMW,KAASb,EAAIE,EAAMS,MAAQV,EAAIC,EAAMY,OAASE,GAEhG3B,EAAO,SAASrC,GACd,GAAIoD,EAgBJ,OAfApD,GAAMiE,iBACDb,EAAMpD,EAAMC,OAAQuB,QAAQ0C,KAAKhC,EAAUuB,SAAUL,IAAQ,IAAOpD,EAAMC,OAAOC,aAAa,0BACjGiC,EAAWnC,EAAMC,OACjB2C,EAAiBS,EAAElB,GAAUgC,QAC7BzB,EAAY0B,MAAMC,MAAQlC,EAASmC,YAAc,KACjD5B,EAAY0B,MAAMG,OAASpC,EAASqC,aAAe,KACnDrC,EAASiC,MAAMK,SAAYpB,EAAElB,GAAUkC,QAAW,KAClDlC,EAASiC,MAAMM,UAAarB,EAAElB,GAAUoC,SAAY,KACpDjB,OAAOqB,iBAAiB,YAAalC,GACrCa,OAAOqB,iBAAiB,UAAWhC,GACnCT,EAAU0C,aAAalC,EAAaP,GACpCU,SAASgC,KAAKC,YAAY3C,GAC1BkB,EAAElB,GAAU4C,SAAS,YACrBtC,EAAKzC,KAEA,GAETyC,EAAO,SAASzC,GACd,GAAIgF,EAIJ,OAHAhF,GAAMiE,iBACN9B,EAASiC,MAAMT,KAAQ3D,EAAMiF,MAAQ,GAAM,KAC3C9C,EAASiC,MAAMP,IAAO7D,EAAMkF,MAAQ,GAAM,KACrC1C,EAAkBxC,EAAMiF,MAAOjF,EAAMkF,QAGtC3C,EAAmBvC,EAAMiF,MAAOjF,EAAMkF,OACxChD,EAAU4C,YAAYpC,IAEtBsC,EAAM5C,EAAapC,EAAMiF,MAAOjF,EAAMkF,OAC1B,MAAPF,GAAgBA,IAAQ1C,IAC3BA,EAAkB0C,EAClB9C,EAAU0C,aAAalC,EAAasC,MAGjC,IAXE,GAaXrC,EAAU,SAAS3C,GACjB,GAAImF,EAUJ,OATAA,GAAe9B,EAAEX,GAAayB,QAC9Bd,EAAElB,GAAUiD,YAAY,YACxBlD,EAAU0C,aAAazC,EAAUO,GACjCR,EAAUmD,YAAY3C,GACtBP,EAASiC,MAAMT,KAAOjB,EAAY0B,MAAMC,MAAQlC,EAASiC,MAAMK,SAAW,GAC1EtC,EAASiC,MAAMP,IAAMnB,EAAY0B,MAAMG,OAASpC,EAASiC,MAAMM,UAAY,GAC3EvC,EAAW,KACXmB,OAAOgC,oBAAoB,YAAa7C,GACxCa,OAAOgC,oBAAoB,UAAW3C,GAClCwC,IAAiBvC,EACZ/D,EAAM0G,OAAO,WAClB,GAAIC,EAGJ,OAFAA,GAAS3G,EAAMiD,cAAc2D,OAAO7C,EAAgB,GAAG,GACvD/D,EAAMiD,cAAc2D,OAAON,EAAc,EAAGK,GACA,kBAA9B3G,GAAMkD,oBAAqClD,EAAMkD,sBAAwB,SAL3F,QASKG,EAAUyC,iBAAiB,YAAatC","file":"shift-components.min.js","sourcesContent":["\n/**\nUI components for SHIFT applications\n\n@requires momentJS\n@requires lodash\n@requires jQuery\n@requires shift.components.sortable\n@requires shift.components.calendar\n\n@module shift.components\n\n@link sortable/\n */\nangular.module('shift.components', ['shift.components.sortable', 'shift.components.calendar']);\n\n\n/**\nCalendar directive displays the date and changes it on click.\n\n@module shift.components.calendar\n\n@requires momentJS\n@requires lodash\n\n@param {moment} date A moment object, default to now\n@param {function} dateChange Called when date is changed\n@param {function} dateValidator A method returning a Boolean indicating if\nthe selected date is valid or not\n\n@example\n```jade\nshift-calendar(\n  date = \"date\"\n  date-change = \"onDateChange(date)\"\n  date-validator = \"isValidDate\"\n)\n```\n */\nangular.module('shift.components.calendar', []).directive('shiftCalendar', [\n  function() {\n    return {\n      restrict: 'E',\n      templateUrl: 'calendar/calendar.html',\n      scope: {\n        date: '=',\n        dateChange: '&',\n        dateValidator: '='\n      },\n      link: function(scope) {\n        var buildCalendarScope, isValidDate, updateDate;\n        if (!moment.isMoment(scope.date)) {\n          updateDate(moment().startOf('day'));\n        }\n        scope.goToNextMonth = function() {\n          var next_month;\n          next_month = moment(scope.date).add(1, 'month');\n          return updateDate(next_month);\n        };\n        scope.goToPreviousMonth = function() {\n          var previous_month;\n          previous_month = moment(scope.date).subtract(1, 'month');\n          return updateDate(previous_month);\n        };\n        scope.selectDate = function($event) {\n          return updateDate(moment(event.target.getAttribute('data-iso')));\n        };\n        isValidDate = function(date) {\n          if (!(moment.isMoment(date) && date.isValid())) {\n            return false;\n          }\n          if (scope.dateValidator != null) {\n            return scope.dateValidator(date);\n          }\n          return true;\n        };\n        updateDate = function(date) {\n          if (isValidDate(date)) {\n            scope.date = date;\n            buildCalendarScope();\n            return scope.dateChange();\n          }\n        };\n        scope.$watch('date', function(new_value, old_value) {\n          if (new_value === old_value) {\n            return;\n          }\n          return buildCalendarScope();\n        });\n        return (buildCalendarScope = function() {\n          var date, day_of_the_month, day_of_the_week, end_date, week;\n          scope.weeks = [];\n          date = moment(scope.date).startOf('month').startOf('week');\n          end_date = moment(scope.date).endOf('month').endOf('week');\n          scope.weeks = [];\n          while (date < end_date) {\n            day_of_the_week = date.day();\n            day_of_the_month = date.date();\n            if (day_of_the_week === 0) {\n              week = [];\n              scope.weeks.push(week);\n            }\n            week.push({\n              iso_8061: date.format(),\n              day_of_the_month: day_of_the_month,\n              is_off: scope.date.month() !== date.month(),\n              is_active: date.format('YYYY-MM-DD') === scope.date.format('YYYY-MM-DD'),\n              is_valid: isValidDate(date)\n            });\n            date.add(1, 'day');\n          }\n          return void 0;\n        })();\n      }\n    };\n  }\n]);\n\n'use strict';\n\nangular.module('shift.components.calendar').run(['$templateCache', function($templateCache) {\n\n  $templateCache.put('calendar/calendar.html', '<div class=\"calendar\"><table class=\"table-condensed\"><thead><tr><th ng-click=\"goToPreviousMonth()\"><i class=\"fa fa-arrow-left\"></i></th><th colspan=\"5\" class=\"month\">{{ date.format(\\'MMM Do, YY\\') }}</th><th ng-click=\"goToNextMonth()\"><i class=\"fa fa-arrow-right\"></i></th></tr><tr><th>Su</th><th>Mo</th><th>Tu</th><th>We</th><th>Th</th><th>Fr</th><th>Sa</th></tr></thead><tbody ng-click=\"selectDate($event)\"><tr ng-repeat=\"week in weeks track by $index\"><td ng-repeat=\"day in week track by $index\" ng-class=\"{active: day.is_active, off: day.is_off, available: day.is_valid, invalid: !day.is_valid}\" data-iso=\"{{ day.iso_8061 }}\">{{ day.day_of_the_month }}</td></tr></tbody></table></div>');\n\n}]);\n\n/**\nSortable directive to allow drag n' drop sorting of an array of object\n\n@module shift.components.sortable\n\n@requires momentJS\n@requires lodash\n\n@param {array} shiftSortable Array of sortable object\n@param {function} shiftSortableChange Called when order is changed\n\n@example\n```jade\nul(\n  shift-sortable = \"list\"\n  shift-sortable-change = \"onListOrderChange(list)\"\n)\n  li(ng-repeat = \"element in list\") {{ element.name }}\n```\n */\nvar indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\nangular.module('shift.components.sortable', []).directive('shiftSortable', function() {\n  return {\n    restrict: 'A',\n    scope: {\n      shiftSortable: '=',\n      shiftSortableChange: '&'\n    },\n    link: function(scope, element, attrs) {\n      var container, dragging, getElementAt, grab, hovered_element, isAfterLastElement, isInsideContainer, move, placeholder, release, start_position;\n      container = element[0];\n      dragging = null;\n      start_position = null;\n      hovered_element = null;\n      placeholder = document.createElement('div');\n      placeholder.className = 'placeholder';\n      getElementAt = function(x, y) {\n        var coord, i, len, ref;\n        y -= $(window).scrollTop();\n        x -= $(window).scrollLeft();\n        ref = container.children;\n        for (i = 0, len = ref.length; i < len; i++) {\n          element = ref[i];\n          coord = element.getBoundingClientRect();\n          if (x > coord.left && x < coord.right && y > coord.top && y < coord.bottom) {\n            if (!element.getAttribute('shift-sortable-still')) {\n              return element;\n            }\n          }\n        }\n      };\n      isInsideContainer = function(x, y) {\n        var coord;\n        y -= $(window).scrollTop();\n        x -= $(window).scrollLeft();\n        coord = container.getBoundingClientRect();\n        return x > coord.left && x < coord.right && y > coord.top && y < coord.bottom;\n      };\n      isAfterLastElement = function(x, y) {\n        var coord, x_offset, y_offset;\n        y -= $(window).scrollTop();\n        x -= $(window).scrollLeft();\n        coord = container.children[container.children.length - 1].getBoundingClientRect();\n        x_offset = (coord.right - coord.left) * .50;\n        y_offset = (coord.bottom - coord.top) * .50;\n        return (x > coord.right - x_offset && y > coord.top) || (x > coord.left && y > coord.bottom - y_offset);\n      };\n      grab = function(event) {\n        var ref;\n        event.preventDefault();\n        if ((ref = event.target, indexOf.call(container.children, ref) >= 0) && !event.target.getAttribute('shift-sortable-still')) {\n          dragging = event.target;\n          start_position = $(dragging).index();\n          placeholder.style.width = dragging.clientWidth + \"px\";\n          placeholder.style.height = dragging.clientHeight + \"px\";\n          dragging.style.minWidth = ($(dragging).width()) + \"px\";\n          dragging.style.minHeight = ($(dragging).height()) + \"px\";\n          window.addEventListener('mousemove', move);\n          window.addEventListener('mouseup', release);\n          container.insertBefore(placeholder, dragging);\n          document.body.appendChild(dragging);\n          $(dragging).addClass('dragging');\n          move(event);\n        }\n        return false;\n      };\n      move = function(event) {\n        var elt;\n        event.preventDefault();\n        dragging.style.left = (event.pageX - 10) + \"px\";\n        dragging.style.top = (event.pageY - 10) + \"px\";\n        if (!isInsideContainer(event.pageX, event.pageY)) {\n          return false;\n        }\n        if (isAfterLastElement(event.pageX, event.pageY)) {\n          container.appendChild(placeholder);\n        } else {\n          elt = getElementAt(event.pageX, event.pageY);\n          if ((elt != null) && elt !== hovered_element) {\n            hovered_element = elt;\n            container.insertBefore(placeholder, elt);\n          }\n        }\n        return false;\n      };\n      release = function(event) {\n        var end_position;\n        end_position = $(placeholder).index();\n        $(dragging).removeClass('dragging');\n        container.insertBefore(dragging, placeholder);\n        container.removeChild(placeholder);\n        dragging.style.left = placeholder.style.width = dragging.style.minWidth = '';\n        dragging.style.top = placeholder.style.height = dragging.style.minHeight = '';\n        dragging = null;\n        window.removeEventListener('mousemove', move);\n        window.removeEventListener('mouseup', release);\n        if (end_position !== start_position) {\n          return scope.$apply(function() {\n            var record;\n            record = scope.shiftSortable.splice(start_position, 1)[0];\n            scope.shiftSortable.splice(end_position, 0, record);\n            return typeof scope.shiftSortableChange === \"function\" ? scope.shiftSortableChange() : void 0;\n          });\n        }\n      };\n      return container.addEventListener('mousedown', grab);\n    }\n  };\n});\n"],"sourceRoot":"/source/"}