{"version":3,"sources":["shift-components.js"],"names":["angular","module","indexOf","item","i","l","this","length","directive","restrict","scope","shiftSortable","shiftSortableChange","link","element","attrs","container","dragging","getElementAt","grab","hovered_element","isAfterLastElement","isInsideContainer","move","placeholder","release","start_position","document","createElement","className","x","y","coord","len","ref","$","window","scrollTop","scrollLeft","children","getBoundingClientRect","left","right","top","bottom","getAttribute","x_offset","y_offset","event","preventDefault","target","call","index","style","width","clientWidth","height","clientHeight","minWidth","minHeight","addEventListener","insertBefore","body","appendChild","addClass","elt","pageX","pageY","end_position","removeClass","removeChild","removeEventListener","$apply","record","splice"],"mappings":"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","file":"shift-components.min.js","sourcesContent":["\n/**\nUI components for SHIFT applications\n\n@requires momentJS\n@requires lodash\n@requires jQuery\n@requires shift.components.sortable\n\n@module shift.components\n\n@link sortable/\n */\nangular.module('shift.components', ['shift.components.sortable']);\n\n\n/**\nSortable directive to allow drag n' drop sorting of an array of object\n\n@module shift.components.sortable\n\n@requires momentJS\n@requires lodash\n\n@param {array} shiftSortable Array of sortable object\n@param {function} shiftSortableChange Called when order is changed\n\n@example\n```jade\nul(\n  shift-sortable = \"list\"\n  shift-sortable-change = \"onListOrderChange(list)\"\n)\n  li(ng-repeat = \"element in list\") {{ element.name }}\n```\n */\nvar indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };\n\nangular.module('shift.components.sortable', []).directive('shiftSortable', function() {\n  return {\n    restrict: 'A',\n    scope: {\n      shiftSortable: '=',\n      shiftSortableChange: '&'\n    },\n    link: function(scope, element, attrs) {\n      var container, dragging, getElementAt, grab, hovered_element, isAfterLastElement, isInsideContainer, move, placeholder, release, start_position;\n      container = element[0];\n      dragging = null;\n      start_position = null;\n      hovered_element = null;\n      placeholder = document.createElement('div');\n      placeholder.className = 'placeholder';\n      getElementAt = function(x, y) {\n        var coord, i, len, ref;\n        y -= $(window).scrollTop();\n        x -= $(window).scrollLeft();\n        ref = container.children;\n        for (i = 0, len = ref.length; i < len; i++) {\n          element = ref[i];\n          coord = element.getBoundingClientRect();\n          if (x > coord.left && x < coord.right && y > coord.top && y < coord.bottom) {\n            if (!element.getAttribute('shift-sortable-still')) {\n              return element;\n            }\n          }\n        }\n      };\n      isInsideContainer = function(x, y) {\n        var coord;\n        y -= $(window).scrollTop();\n        x -= $(window).scrollLeft();\n        coord = container.getBoundingClientRect();\n        return x > coord.left && x < coord.right && y > coord.top && y < coord.bottom;\n      };\n      isAfterLastElement = function(x, y) {\n        var coord, x_offset, y_offset;\n        y -= $(window).scrollTop();\n        x -= $(window).scrollLeft();\n        coord = container.children[container.children.length - 1].getBoundingClientRect();\n        x_offset = (coord.right - coord.left) * .50;\n        y_offset = (coord.bottom - coord.top) * .50;\n        return (x > coord.right - x_offset && y > coord.top) || (x > coord.left && y > coord.bottom - y_offset);\n      };\n      grab = function(event) {\n        var ref;\n        event.preventDefault();\n        if ((ref = event.target, indexOf.call(container.children, ref) >= 0) && !event.target.getAttribute('shift-sortable-still')) {\n          dragging = event.target;\n          start_position = $(dragging).index();\n          placeholder.style.width = dragging.clientWidth + \"px\";\n          placeholder.style.height = dragging.clientHeight + \"px\";\n          dragging.style.minWidth = ($(dragging).width()) + \"px\";\n          dragging.style.minHeight = ($(dragging).height()) + \"px\";\n          window.addEventListener('mousemove', move);\n          window.addEventListener('mouseup', release);\n          container.insertBefore(placeholder, dragging);\n          document.body.appendChild(dragging);\n          $(dragging).addClass('dragging');\n          move(event);\n        }\n        return false;\n      };\n      move = function(event) {\n        var elt;\n        event.preventDefault();\n        dragging.style.left = (event.pageX - 10) + \"px\";\n        dragging.style.top = (event.pageY - 10) + \"px\";\n        if (!isInsideContainer(event.pageX, event.pageY)) {\n          return false;\n        }\n        if (isAfterLastElement(event.pageX, event.pageY)) {\n          container.appendChild(placeholder);\n        } else {\n          elt = getElementAt(event.pageX, event.pageY);\n          if ((elt != null) && elt !== hovered_element) {\n            hovered_element = elt;\n            container.insertBefore(placeholder, elt);\n          }\n        }\n        return false;\n      };\n      release = function(event) {\n        var end_position;\n        end_position = $(placeholder).index();\n        $(dragging).removeClass('dragging');\n        container.insertBefore(dragging, placeholder);\n        container.removeChild(placeholder);\n        dragging.style.left = placeholder.style.width = dragging.style.minWidth = '';\n        dragging.style.top = placeholder.style.height = dragging.style.minHeight = '';\n        dragging = null;\n        window.removeEventListener('mousemove', move);\n        window.removeEventListener('mouseup', release);\n        if (end_position !== start_position) {\n          return scope.$apply(function() {\n            var record;\n            record = scope.shiftSortable.splice(start_position, 1)[0];\n            scope.shiftSortable.splice(end_position, 0, record);\n            return typeof scope.shiftSortableChange === \"function\" ? scope.shiftSortableChange() : void 0;\n          });\n        }\n      };\n      return container.addEventListener('mousedown', grab);\n    }\n  };\n});\n"],"sourceRoot":"/source/"}