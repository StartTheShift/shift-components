angular.module("shift.components",["shift.components.sortable","shift.components.calendar","shift.components.select","shift.components.typeahead"]),angular.module("shift.components.calendar",[]).directive("shiftCalendar",function(){return{restrict:"E",templateUrl:"calendar/calendar.html",scope:{date:"=",dateChange:"&",dateValidator:"=",dateHightlight:"=",dateAllowNull:"="},link:function(e){var t,n,o;return e.goToNextMonth=function(){return e.showing_date.add(1,"month"),t()},e.goToPreviousMonth=function(){return e.showing_date.subtract(1,"month"),t()},e.goToSelectedDate=function(){return e.showing_date=moment(e.date),t()},e.selectDate=function(e){return o(moment(e.target.getAttribute("data-iso")))},e.setNull=function(){return e.dateAllowNull?(e.date=null,t(),e.dateChange()):void 0},n=function(t){return moment.isMoment(t)&&t.isValid()?null!=e.dateValidator?e.dateValidator(t):!0:!1},o=function(o){return n(o)?(e.date=o,e.showing_date=moment(o),t(),e.dateChange()):void 0},e.$watch("date",function(e,t){return e!==t?o(e):void 0}),e.getClass=function(t){var o;return{active:null!=(o=e.date)?o.isSame(t,"day"):void 0,off:!e.showing_date.isSame(t,"month"),available:n(t),invalid:!n(t),highlight:"function"==typeof e.dateHightlight?e.dateHightlight(t):void 0}},(t=function(){var t,n,o,i,r,a;for(t=moment(e.showing_date).startOf("month").startOf("week"),i=moment(e.showing_date).endOf("month").endOf("week"),e.weeks=[],r=[];;){if(o=t.day(),n=t.date(),0===o){if(e.weeks.length>5)break;a=[],e.weeks.push(a)}a.push({iso_8061:t.format(),day_of_the_month:n,date:moment(t)}),r.push(t.add(1,"day"))}return r})(),e.dateAllowNull||moment.isMoment(e.date)||(e.date=moment()),moment.isMoment(e.date)?(o(e.date),e.showing_date=moment(e.date)):e.showing_date=moment().startOf("day")}}}),angular.module("shift.components.calendar").run(["$templateCache",function(e){e.put("calendar/calendar.html",'<div class="calendar"><table class="table-condensed"><thead><tr><th title="previous month" ng-click="goToPreviousMonth()"><i class="fa fa-chevron-left"></i></th><th><i ng-if="date" title="go to {{ date.format(\'MMMM Do, YYYY\') }}" ng-hide="showing_date.isSame(date, \'month\')" ng-click="goToSelectedDate()" class="fa fa-dot-circle-o"></i></th><th colspan="3" class="month">{{ showing_date.format(\'MMM YYYY\') }}</th><th><i title="Unset date" ng-click="setNull()" ng-if="date &amp;&amp; dateAllowNull" class="fa fa-times"></i></th><th title="next month" ng-click="goToNextMonth()"><i class="fa fa-chevron-right"></i></th></tr><tr><th>Su</th><th>Mo</th><th>Tu</th><th>We</th><th>Th</th><th>Fr</th><th>Sa</th></tr></thead><tbody ng-click="selectDate($event)"><tr ng-repeat="week in weeks track by $index"><td ng-repeat="day in week track by $index" ng-class="getClass(day.date)" data-iso="{{ day.iso_8061 }}">{{ day.day_of_the_month }}</td></tr></tbody></table></div>')}]),angular.module("shift.components.select",[]).directive("shiftSelect",["$compile",function(e){var t,n,o;return o=38,t=40,n=13,{restrict:"E",transclude:!0,scope:{options:"=",selected:"=",onSelect:"&"},link:function(i,r,a,l,s){var d,c,u,h,f,p;return h=angular.element(document.createElement("div")),h.addClass("select-container"),h.attr({"ng-if":"options.length"}),u=angular.element(document.createElement("div")),u.addClass("select-option"),u.attr({"ng-repeat":"option in options","ng-class":"getClass($index)","ng-click":"select($index)","ng-mouseenter":"setPosition($index)"}),s(i,function(e,t){return u.append(e)}),h.append(u),r.append(h),e(h)(i),e(u)(i),i.position=-1,c=function(e){var r,a;if((null!=(a=i.options)?a.length:void 0)&&(r=e.which||e.keyCode,r===o||r===t||r===n))return i.$apply(function(){switch(r){case o:i.position-=1;break;case t:i.position+=1;break;default:i.position>-1&&i.select(i.position)}return i.position=Math.max(0,i.position),i.position=Math.min(i.options.length-1,i.position),d()}),e.preventDefault(),e.stopPropagation(),!1},d=function(){var e,t,n,o,a,l;return e=r[0].children[0],o=e.children[i.position],a=o.getBoundingClientRect(),t=e.getBoundingClientRect(),l=getComputedStyle(o),a.bottom>t.bottom&&(n=parseInt(l.marginBottom,10),e.scrollTop+=a.bottom-t.bottom+n),a.top<t.top?(n=parseInt(l.marginTop,10),e.scrollTop+=a.top-t.top-n):void 0},i.select=function(e){return i.position=e,i.selected=i.options[i.position],i.onSelect({selected:i.selected})},i.setPosition=function(e){return i.position=e},i.getClass=function(e){return{selected:e===i.position}},(f=function(){return document.addEventListener("keydown",c)})(),p=function(){return document.removeEventListener("keydown",c)},void i.$on("$destroy",p)}}}]);var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};angular.module("shift.components.sortable",[]).service("shiftSortableService",function(){var e;return e={},{register:function(t,n,o){return null==e[t]&&(e[t]=[]),e[t].push({container:n,scope:o}),e[t]}}}).directive("shiftSortable",["shiftSortableService",function(e){return{restrict:"A",scope:{shiftSortable:"=",shiftSortableChange:"&",shiftSortableAdd:"&",shiftSortableRemove:"&",shiftSortableHandle:"@",shiftSortableNamespace:"@"},link:function(t,n,o){var i,r,a,l,s,d,c,u,h,f,p,m,g,v;return i=n[0],r=null,v=null,s=null,u={},p=document.createElement("div"),p.className="placeholder",t.shiftSortableNamespace&&(g=e.register(t.shiftSortableNamespace,i,t)),a=function(e,t,o){var i,r,a,l,s,h;for(l=e.children[e.children.length-1],h=e.children,a=r=0,s=h.length;s>r;a=++r)if(n=h[a],i=n.getBoundingClientRect(),c(t,o,i))return d(t,o,i)?n:n===l?u:e.children[a+1]},d=function(e,t,n){var o,i;return t-=$(window).scrollTop(),e-=$(window).scrollLeft(),o=e-n.left,i=n.top+n.height-t,i>o/n.width*n.height},c=function(e,t,n){return t-=$(window).scrollTop(),e-=$(window).scrollLeft(),e>n.left&&e<n.right&&t>n.top&&t<n.bottom},l=function(e){var n;if(n=e.target,null!=t.shiftSortableHandle){if(!n.matches(t.shiftSortableHandle))return;for(;n.parentNode!==i;)n=n.parentNode}return e.preventDefault(),indexOf.call(i.children,n)>=0&&(r=n,v=$(r).index(),p.style.width=r.clientWidth+"px",p.style.height=r.clientHeight+"px",r.style.minWidth=$(r).width()+"px",r.style.minHeight=$(r).height()+"px",window.addEventListener("mousemove",h),window.addEventListener("mouseup",m),i.insertBefore(p,r),document.body.appendChild(r),$(r).addClass("dragging"),h(e)),!1},h=function(e){var n,o,a,l;if(e.preventDefault(),r.style.left=e.pageX-10+"px",r.style.top=e.pageY-10+"px",t.shiftSortableNamespace){for(a=[],n=0,o=g.length;o>n;n++)l=g[n],a.push(f(l.container,e));return a}return f(i,e)},f=function(e,t){var n;return c(t.pageX,t.pageY,e.getBoundingClientRect())?(0===e.children.length?e.appendChild(p):(n=a(e,t.pageX,t.pageY),null!=n&&(n===u?e.appendChild(p):n!==s&&(s=n,e.insertBefore(p,n)))),!1):!1},m=function(e){var n,o,a,l,s,d,c,u,f;if(a=$(p).index(),o=p.parentNode,n=o!==i,d=a!==v,$(r).removeClass("dragging"),n||d||o.insertBefore(r,p),o.removeChild(p),r.style.left=p.style.width=r.style.minWidth="",r.style.top=p.style.height=r.style.minHeight="",r=null,window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",m),n){for(c=null,t.$apply(function(){return c=t.shiftSortable.splice(v,1)[0],t.shiftSortableChange(),t.shiftSortableRemove({item:c})}),u=[],l=0,s=g.length;s>l;l++)f=g[l],u.push(f.container===o?f.scope.$apply(function(){return f.scope.shiftSortable.splice(a,0,c),f.scope.shiftSortableChange(),f.scope.shiftSortableAdd({item:c})}):void 0);return u}return d?t.$apply(function(){return c=t.shiftSortable.splice(v,1)[0],t.shiftSortable.splice(a,0,c),t.shiftSortableChange()}):void 0},i.addEventListener("mousedown",l),t.$on("$destroy",function(){return i.removeEventListener("mousedown",l),g?_.remove(g,function(e){return e.scope===t}):void 0})}}}]),angular.module("shift.components.typeahead",["shift.components.select"]).directive("shiftTypeahead",["$compile","$filter",function(e,t){return{restrict:"E",transclude:!0,templateUrl:"typeahead/typeahead.html",scope:{source:"=",filterAttribute:"@",selected:"="},link:function(n,o,i,r,a){var l,s,d,c;return d=angular.element(document.createElement("shift-select")),d.attr({"ng-show":"show_select_menu && !selected",options:"options",selected:"selected","on-select":"onSelect(selected)","ng-mousedown":"mouseDown(true)","ng-mouseup":"mouseDown(false)"}),c=n.$new(),a(c,function(e){return d.append(e)}),o.append(d),e(d)(c),l=function(){var e;return n.query?(e={},e[n.filterAttribute]=n.query,n.options=t("filter")(n.source,e).slice(0,6)):n.options=[]},s=!1,n.mouseDown=function(e){return s=e},n.hide=function(e){return s?void 0:n.show_select_menu=!1},n.onSelect=function(e){return n.selected=e,n.query=null!=e?e[n.filterAttribute]:void 0},n.$watch("query",function(e,t){var o;if(e!==t)return n.query!==(null!=(o=n.selected)?o[n.filterAttribute]:void 0)&&(n.selected=null),l()})}}}]),angular.module("shift.components.typeahead").run(["$templateCache",function(e){e.put("typeahead/typeahead.html",'<input type="text" ng-blur="hide($event)" ng-focus="show_select_menu = true" ng-model="query">')}]);
//# sourceMappingURL=shift-components.min.js.map