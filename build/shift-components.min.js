angular.module("shift.components",["shift.components.sortable","shift.components.calendar","shift.components.select","shift.components.typeahead"]),angular.module("shift.components.calendar",[]).directive("shiftCalendar",function(){return{restrict:"E",templateUrl:"calendar/calendar.html",scope:{date:"=",dateChange:"&",dateValidator:"=",dateHightlight:"=",dateAllowNull:"="},link:function(e){var t,n,o;return e.goToNextMonth=function(){return e.showing_date.add(1,"month"),t()},e.goToPreviousMonth=function(){return e.showing_date.subtract(1,"month"),t()},e.goToSelectedDate=function(){return e.showing_date=moment(e.date),t()},e.selectDate=function(e){return o(moment(e.target.getAttribute("data-iso")))},e.setNull=function(){return e.dateAllowNull?(e.date=null,t(),e.dateChange()):void 0},n=function(t){return moment.isMoment(t)&&t.isValid()?null!=e.dateValidator?e.dateValidator(t):!0:!1},o=function(o){return n(o)?(e.date=o,e.showing_date=moment(o),t(),e.dateChange()):void 0},e.$watch("date",function(e,t){return e!==t?o(e):void 0}),e.getClass=function(t){var o;return{active:null!=(o=e.date)?o.isSame(t,"day"):void 0,off:!e.showing_date.isSame(t,"month"),available:n(t),invalid:!n(t),highlight:"function"==typeof e.dateHightlight?e.dateHightlight(t):void 0}},(t=function(){var t,n,o,i,a,l;for(t=moment(e.showing_date).startOf("month").startOf("week"),i=moment(e.showing_date).endOf("month").endOf("week"),e.weeks=[],a=[];;){if(o=t.day(),n=t.date(),0===o){if(e.weeks.length>5)break;l=[],e.weeks.push(l)}l.push({iso_8061:t.format(),day_of_the_month:n,date:moment(t)}),a.push(t.add(1,"day"))}return a})(),e.dateAllowNull||moment.isMoment(e.date)||(e.date=moment()),moment.isMoment(e.date)?(o(e.date),e.showing_date=moment(e.date)):e.showing_date=moment().startOf("day")}}}),angular.module("shift.components.calendar").run(["$templateCache",function(e){e.put("calendar/calendar.html",'<div class="calendar"><table class="table-condensed"><thead><tr><th title="previous month" ng-click="goToPreviousMonth()"><i class="fa fa-chevron-left"></i></th><th><i ng-if="date" title="go to {{ date.format(\'MMMM Do, YYYY\') }}" ng-hide="showing_date.isSame(date, \'month\')" ng-click="goToSelectedDate()" class="fa fa-dot-circle-o"></i></th><th colspan="3" class="month">{{ showing_date.format(\'MMM YYYY\') }}</th><th><i title="Unset date" ng-click="setNull()" ng-if="date &amp;&amp; dateAllowNull" class="fa fa-times"></i></th><th title="next month" ng-click="goToNextMonth()"><i class="fa fa-chevron-right"></i></th></tr><tr><th>Su</th><th>Mo</th><th>Tu</th><th>We</th><th>Th</th><th>Fr</th><th>Sa</th></tr></thead><tbody ng-click="selectDate($event)"><tr ng-repeat="week in weeks track by $index"><td ng-repeat="day in week track by $index" ng-class="getClass(day.date)" data-iso="{{ day.iso_8061 }}">{{ day.day_of_the_month }}</td></tr></tbody></table></div>')}]);var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};angular.module("shift.components.sortable",[]).directive("shiftSortable",function(){return{restrict:"A",scope:{shiftSortable:"=",shiftSortableChange:"&",shiftSortableHandle:"@"},link:function(e,t,n){var o,i,a,l,r,s,d,c,u,h,f,m;return o=t[0],i=null,m=null,r=null,c={},h=document.createElement("div"),h.className="placeholder",a=function(e,n){var i,a,l,r,u,h;for(r=o.children[o.children.length-1],h=o.children,l=a=0,u=h.length;u>a;l=++a)if(t=h[l],i=t.getBoundingClientRect(),d(e,n,i))return s(e,n,i)?t:t===r?c:o.children[l+1]},s=function(e,t,n){var o,i;return t-=$(window).scrollTop(),e-=$(window).scrollLeft(),o=e-n.left,i=n.top+n.height-t,i>o/n.width*n.height},d=function(e,t,n){return t-=$(window).scrollTop(),e-=$(window).scrollLeft(),e>n.left&&e<n.right&&t>n.top&&t<n.bottom},l=function(t){var n;if(t.preventDefault(),n=t.target,null!=e.shiftSortableHandle){if(!n.matches(e.shiftSortableHandle))return;for(;n.parentElement!==o;)n=n.parentElement}return indexOf.call(o.children,n)>=0&&(i=n,m=$(i).index(),h.style.width=i.clientWidth+"px",h.style.height=i.clientHeight+"px",i.style.minWidth=$(i).width()+"px",i.style.minHeight=$(i).height()+"px",window.addEventListener("mousemove",u),window.addEventListener("mouseup",f),o.insertBefore(h,i),document.body.appendChild(i),$(i).addClass("dragging"),u(t)),!1},u=function(e){var t;return e.preventDefault(),i.style.left=e.pageX-10+"px",i.style.top=e.pageY-10+"px",d(e.pageX,e.pageY,o.getBoundingClientRect())?(t=a(e.pageX,e.pageY),null!=t&&(t===c?o.appendChild(h):t!==r&&(r=t,o.insertBefore(h,t))),!1):!1},f=function(t){var n;return n=$(h).index(),$(i).removeClass("dragging"),o.insertBefore(i,h),o.removeChild(h),i.style.left=h.style.width=i.style.minWidth="",i.style.top=h.style.height=i.style.minHeight="",i=null,window.removeEventListener("mousemove",u),window.removeEventListener("mouseup",f),n!==m?e.$apply(function(){var t;return t=e.shiftSortable.splice(m,1)[0],e.shiftSortable.splice(n,0,t),e.shiftSortableChange()}):void 0},o.addEventListener("mousedown",l)}}}),angular.module("shift.components.select",[]).directive("shiftSelect",function(e){var t,n,o;return o=38,t=40,n=13,{restrict:"E",transclude:!0,scope:{options:"=",selected:"=",onSelect:"&"},link:function(i,a,l,r,s){var d,c,u,h,f,m;return h=angular.element(document.createElement("div")),h.addClass("select-container"),h.attr({"ng-if":"!selected && options.length"}),u=angular.element(document.createElement("div")),u.addClass("select-option"),u.attr({"ng-repeat":"option in options","ng-class":"getClass($index)","ng-click":"select($index)","ng-mouseenter":"setPosition($index)"}),s(i,function(e,t){return u.append(e)}),h.append(u),a.append(h),e(h)(i),e(u)(i),i.position=-1,c=function(e){var a,l;if((null!=(l=i.options)?l.length:void 0)&&(a=e.which||e.keyCode,a===o||a===t||a===n))return i.$apply(function(){switch(a){case o:i.position-=1;break;case t:i.position+=1;break;default:i.position>-1&&i.select(i.position)}return i.position=Math.max(0,i.position),i.position=Math.min(i.options.length-1,i.position),d()}),e.preventDefault(),e.stopPropagation(),!1},d=function(){var e,t,n,o;return e=a[0].children[0],n=e.children[i.position],o=n.getBoundingClientRect(),t=e.getBoundingClientRect(),o.bottom>t.bottom&&(e.scrollTop+=o.bottom-t.bottom+5),o.top<t.top?e.scrollTop+=o.top-t.top-5:void 0},i.select=function(e){return i.position=e,i.selected=i.options[i.position],i.onSelect({selected:i.selected})},i.setPosition=function(e){return i.position=e},i.getClass=function(e){return{selected:e===i.position}},(f=function(){return document.addEventListener("keydown",c)})(),m=function(){return document.removeEventListener("keydown",c)},void i.$on("$destroy",m)}}}),angular.module("shift.components.typeahead",["shift.components.select"]).directive("shiftTypeahead",function(e,t){return{restrict:"E",transclude:!0,templateUrl:"typeahead/typeahead.html",scope:{source:"=",filterAttribute:"@",selected:"="},link:function(n,o,i,a,l){var r,s,d,c;return d=angular.element(document.createElement("shift-select")),d.attr({"ng-show":"show_select_menu",options:"options",selected:"selected","on-select":"onSelect(selected)","ng-mousedown":"mouseDown(true)","ng-mouseup":"mouseDown(false)"}),c=n.$new(),l(c,function(e){return d.append(e)}),o.append(d),e(d)(c),r=function(){var e;return n.query?(e={},e[n.filterAttribute]=n.query,n.options=t("filter")(n.source,e).slice(0,6)):n.options=[]},s=!1,n.mouseDown=function(e){return s=e},n.hide=function(e){return s?void 0:n.show_select_menu=!1},n.onSelect=function(e){return n.selected=e,n.query=null!=e?e[n.filterAttribute]:void 0},n.$watch("query",function(e,t){var o;if(e!==t)return n.query!==(null!=(o=n.selected)?o[n.filterAttribute]:void 0)&&(n.selected=null),r()})}}}),angular.module("shift.components.typeahead").run(["$templateCache",function(e){e.put("typeahead/typeahead.html",'<input type="text" ng-blur="hide($event)" ng-focus="show_select_menu = true" ng-model="query">')}]);
//# sourceMappingURL=shift-components.min.js.map