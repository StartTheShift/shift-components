angular.module("shift.components",["shift.components.sortable","shift.components.calendar","shift.components.selector","shift.components.typeahead"]),angular.module("shift.components.calendar",[]).directive("shiftCalendar",function(){return{restrict:"E",templateUrl:"calendar/calendar.html",scope:{date:"=",dateChange:"&",dateValidator:"=",dateHightlight:"=",dateAllowNull:"="},link:function(e){var t,n,o;return e.goToNextMonth=function(){return e.showing_date.add(1,"month"),t()},e.goToPreviousMonth=function(){return e.showing_date.subtract(1,"month"),t()},e.goToSelectedDate=function(){return e.showing_date=moment(e.date),t()},e.selectDate=function(e){return o(moment(e.target.getAttribute("data-iso")))},e.setNull=function(){return e.dateAllowNull?(e.date=null,t(),e.dateChange()):void 0},n=function(t){return moment.isMoment(t)&&t.isValid()?null!=e.dateValidator?e.dateValidator(t):!0:!1},o=function(o){return n(o)?(e.date=o,e.showing_date=moment(o),t(),e.dateChange()):void 0},e.$watch("date",function(e,t){return e!==t?o(e):void 0}),e.getClass=function(t){var o;return{active:null!=(o=e.date)?o.isSame(t,"day"):void 0,off:!e.showing_date.isSame(t,"month"),available:n(t),invalid:!n(t),highlight:"function"==typeof e.dateHightlight?e.dateHightlight(t):void 0}},(t=function(){var t,n,o,i,l,r;for(t=moment(e.showing_date).startOf("month").startOf("week"),i=moment(e.showing_date).endOf("month").endOf("week"),e.weeks=[],l=[];;){if(o=t.day(),n=t.date(),0===o){if(e.weeks.length>5)break;r=[],e.weeks.push(r)}r.push({iso_8061:t.format(),day_of_the_month:n,date:moment(t)}),l.push(t.add(1,"day"))}return l})(),e.dateAllowNull||moment.isMoment(e.date)||(e.date=moment()),moment.isMoment(e.date)?(o(e.date),e.showing_date=moment(e.date)):e.showing_date=moment().startOf("day")}}}),angular.module("shift.components.calendar").run(["$templateCache",function(e){e.put("calendar/calendar.html",'<div class="calendar"><table class="table-condensed"><thead><tr><th title="previous month" ng-click="goToPreviousMonth()"><i class="fa fa-chevron-left"></i></th><th><i ng-if="date" title="go to {{ date.format(\'MMMM Do, YYYY\') }}" ng-hide="showing_date.isSame(date, \'month\')" ng-click="goToSelectedDate()" class="fa fa-dot-circle-o"></i></th><th colspan="3" class="month">{{ showing_date.format(\'MMM YYYY\') }}</th><th><i title="Unset date" ng-click="setNull()" ng-if="date &amp;&amp; dateAllowNull" class="fa fa-times"></i></th><th title="next month" ng-click="goToNextMonth()"><i class="fa fa-chevron-right"></i></th></tr><tr><th>Su</th><th>Mo</th><th>Tu</th><th>We</th><th>Th</th><th>Fr</th><th>Sa</th></tr></thead><tbody ng-click="selectDate($event)"><tr ng-repeat="week in weeks track by $index"><td ng-repeat="day in week track by $index" ng-class="getClass(day.date)" data-iso="{{ day.iso_8061 }}">{{ day.day_of_the_month }}</td></tr></tbody></table></div>')}]);var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};angular.module("shift.components.selector",[]).directive("shiftSelector",["$compile",function(e){var t,n,o;return o=38,t=40,n=13,{restrict:"E",transclude:!0,scope:{options:"=",selected:"=?",onSelect:"&",onDiscard:"&"},link:function(i,l,r,s,a){var c,u,d,h,p,f,m,g;return f=angular.element(document.createElement("div")),f.addClass("select-container"),f.attr({"ng-if":"options.length"}),h=angular.element(document.createElement("div")),h.addClass("select-option"),h.attr({"ng-repeat":"option in options","ng-class":"getClass($index)","ng-click":"toggle($index, $event)","ng-mouseenter":"setPosition($index, $event)"}),a(i,function(e,t){return h.append(e)}),f.append(h),l.append(f),e(f)(i),e(h)(i),i.position=-1,null!=r.multiple&&null==i.selected&&(i.selected=[]),d=function(e){var l,r;if((null!=(r=i.options)?r.length:void 0)&&(l=e.which||e.keyCode,l===o||l===t||l===n))return i.$apply(function(){switch(l){case o:i.position-=1;break;case t:i.position+=1;break;default:i.position>-1&&i.toggle(i.position,e)}return i.position=Math.max(0,i.position),i.position=Math.min(i.options.length-1,i.position),c()}),e.preventDefault(),e.stopPropagation(),!1},c=function(){var e,t,n,o,r,s;return e=l[0].children[0],o=e.children[i.position],r=o.getBoundingClientRect(),t=e.getBoundingClientRect(),s=getComputedStyle(o),r.bottom>t.bottom&&(n=parseInt(s.marginBottom,10),e.scrollTop+=r.bottom-t.bottom+n),r.top<t.top?(n=parseInt(s.marginTop,10),e.scrollTop+=r.top-t.top-n):void 0},u=function(e){return null!=r.multiple?indexOf.call(i.selected,e)>=0:e===i.selected},i.toggle=function(e,t){return t.stopPropagation(),h=i.options[e],u(h)?i.discard(e):i.select(e),!1},i.select=function(e){var t;return i.position=e,t=i.options[i.position],null!=r.multiple?i.selected.push(t):i.selected=t,i.onSelect({selected:t})},i.discard=function(e){var t;return i.position=e,t=i.options[i.position],null!=r.multiple?_.pull(i.selected,t):i.selected=null,i.onDiscard({discarded:t})},p=0,i.setPosition=function(e,t){return t.clientY!==p?(p=t.clientY,i.position=e):void 0},i.getClass=function(e){var t;return{selected:u(null!=(t=i.options)?t[e]:void 0),active:e===i.position}},(m=function(){return document.addEventListener("keydown",d)})(),g=function(){return document.removeEventListener("keydown",d)},i.$on("$destroy",g)}}}]);var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};angular.module("shift.components.sortable",[]).service("shiftSortableService",function(){var e;return e={},{register:function(t,n,o){return null==e[t]&&(e[t]=[]),e[t].push({container:n,scope:o}),e[t]}}}).directive("shiftSortable",["shiftSortableService",function(e){return{restrict:"A",scope:{shiftSortable:"=",shiftSortableChange:"&",shiftSortableAdd:"&",shiftSortableRemove:"&",shiftSortableHandle:"@",shiftSortableNamespace:"@"},link:function(t,n,o){var i,l,r,s,a,c,u,d,h,p,f,m,g,v;return i=n[0],l=null,v=null,a=null,d={},f=document.createElement("div"),f.className="placeholder",t.shiftSortableNamespace&&(g=e.register(t.shiftSortableNamespace,i,t)),r=function(e,t,o){var i,l,r,s,a,h;for(s=e.children[e.children.length-1],h=e.children,r=l=0,a=h.length;a>l;r=++l)if(n=h[r],i=n.getBoundingClientRect(),u(t,o,i))return c(t,o,i)?n:n===s?d:e.children[r+1]},c=function(e,t,n){var o,i;return t-=$(window).scrollTop(),e-=$(window).scrollLeft(),o=e-n.left,i=n.top+n.height-t,i>o/n.width*n.height},u=function(e,t,n){return t-=$(window).scrollTop(),e-=$(window).scrollLeft(),e>n.left&&e<n.right&&t>n.top&&t<n.bottom},s=function(e){var n;if(n=e.target,null!=t.shiftSortableHandle){if(!n.matches(t.shiftSortableHandle))return;for(;n.parentNode!==i;)n=n.parentNode}return e.preventDefault(),indexOf.call(i.children,n)>=0&&(l=n,v=$(l).index(),f.style.width=l.clientWidth+"px",f.style.height=l.clientHeight+"px",l.style.minWidth=$(l).width()+"px",l.style.minHeight=$(l).height()+"px",window.addEventListener("mousemove",h),window.addEventListener("mouseup",m),i.insertBefore(f,l),document.body.appendChild(l),$(l).addClass("dragging"),h(e)),!1},h=function(e){var n,o,r,s;if(e.preventDefault(),l.style.left=e.pageX-10+"px",l.style.top=e.pageY-10+"px",t.shiftSortableNamespace){for(r=[],n=0,o=g.length;o>n;n++)s=g[n],r.push(p(s.container,e));return r}return p(i,e)},p=function(e,t){var n;return u(t.pageX,t.pageY,e.getBoundingClientRect())?(0===e.children.length?e.appendChild(f):(n=r(e,t.pageX,t.pageY),null!=n&&(n===d?e.appendChild(f):n!==a&&(a=n,e.insertBefore(f,n)))),!1):!1},m=function(e){var n,o,r,s,a,c,u,d,p;if(r=$(f).index(),o=f.parentNode,n=o!==i,c=r!==v,$(l).removeClass("dragging"),n||c||o.insertBefore(l,f),o.removeChild(f),l.style.left=f.style.width=l.style.minWidth="",l.style.top=f.style.height=l.style.minHeight="",l=null,window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",m),n){for(u=null,t.$apply(function(){return u=t.shiftSortable.splice(v,1)[0],t.shiftSortableChange(),t.shiftSortableRemove({item:u})}),d=[],s=0,a=g.length;a>s;s++)p=g[s],d.push(p.container===o?p.scope.$apply(function(){return p.scope.shiftSortable.splice(r,0,u),p.scope.shiftSortableChange(),p.scope.shiftSortableAdd({item:u})}):void 0);return d}return c?t.$apply(function(){return u=t.shiftSortable.splice(v,1)[0],t.shiftSortable.splice(r,0,u),t.shiftSortableChange()}):void 0},i.addEventListener("mousedown",s),t.$on("$destroy",function(){return i.removeEventListener("mousedown",s),g?_.remove(g,function(e){return e.scope===t}):void 0})}}}]),angular.module("shift.components.typeahead",["shift.components.selector"]).directive("shiftTypeahead",["$compile","$filter",function(e,t){return{restrict:"E",transclude:!0,templateUrl:"typeahead/typeahead.html",scope:{source:"=",filterAttribute:"@",selected:"=",onOptionSelect:"&",onOptionDeselect:"&",placeholder:"@",show_options_on_focus:"=showOptionsOnFocus",show_select_menu:"=?showSelectMenu",close_menu_on_esc:"=closeMenuOnEsc"},link:function(n,o,i,l,r){var s,a,c,u,d,h,p,f;return n.options=[],null==n.show_select_menu&&(n.show_select_menu=!1),n.onSelectMultiOption=function(e){return n.onOptionSelect({option:e})},n.onDeselectMultiOption=function(e){return n.onOptionDeselect({option:e})},d=angular.element(document.createElement("shift-selector")),d.attr({"ng-show":"show_select_menu && !selected",options:"options",selected:"selected","on-select":"onSelect(selected)","ng-mousedown":"mouseDown(true)","ng-mouseup":"mouseDown(false)"}),null!=i.multiselect&&d.attr({multiple:"true","on-select":"onSelectMultiOption(selected)","on-discard":"onDeselectMultiOption(discarded)","ng-show":"show_select_menu"}),h=n.$new(),r(h,function(e){return d.append(e)}),o.append(d),e(d)(h),s=function(){var e;return n.query?(e={},e[n.filterAttribute]=n.query,n.options=t("filter")(n.source,e).slice(0,6),n.show_select_menu=!0):n.options=[]},a=!1,n.mouseDown=function(e){return a=e},n.hide=function(e){return a?void 0:n.show_select_menu=!1},n.onFocus=function(e){return n.show_select_menu=!0,n.show_options_on_focus?n.query?s():n.options=n.source:void 0},n.onSelect=function(e){return n.selected=e,n.query=null!=e?e[n.filterAttribute]:void 0},n.$watch("query",function(e,t){var o;if(e!==t)return null==i.multiselect&&n.query!==(null!=(o=n.selected)?o[n.filterAttribute]:void 0)&&(n.selected=null),s()}),c=function(e){var t;return t=e.which||e.keyCode,n.close_menu_on_esc&&27===t&&n.show_select_menu?(e.stopPropagation(),n.$apply(function(){return n.show_select_menu=!1})):void 0},u=function(e){n.show_select_menu&&(o.has(e.target).length||n.$apply(function(){return n.show_select_menu=!1}))},(p=function(){return document.addEventListener("keyup",c),null!=i.multiselect?document.addEventListener("mousedown",u):void 0})(),f=function(){return document.removeEventListener("keyup",c),document.removeEventListener("mousedown",u)},n.$on("$destroy",f)}}}]),angular.module("shift.components.typeahead").run(["$templateCache",function(e){e.put("typeahead/typeahead.html",'<input type="text" ng-blur="hide($event)" ng-class="{\'select-menu-visible\': show_select_menu &amp;&amp; options.length}" ng-focus="onFocus($event)" ng-model="query" placeholder="{{placeholder}}">')}]);
//# sourceMappingURL=shift-components.min.js.map