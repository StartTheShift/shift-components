angular.module("shift.components",["shift.components.sortable","shift.components.calendar","shift.components.selector","shift.components.typeahead","shift.components.select","shift.components.time"]),angular.module("shift.components.calendar",[]).directive("shiftCalendar",function(){return{restrict:"E",templateUrl:"calendar/calendar.html",scope:{date:"=",dateChange:"&",dateValidator:"=",dateHightlight:"=",dateAllowNull:"="},link:function(e){var t,n,o;return e.goToNextMonth=function(){return e.showing_date.add(1,"month"),t()},e.goToPreviousMonth=function(){return e.showing_date.subtract(1,"month"),t()},e.goToSelectedDate=function(){return e.showing_date=moment(e.date),t()},e.selectDate=function(e){return o(moment(e.target.getAttribute("data-iso")))},e.setNull=function(){return e.dateAllowNull?(e.date=null,t(),e.dateChange()):void 0},n=function(t){return moment.isMoment(t)&&t.isValid()?null!=e.dateValidator?e.dateValidator(t):!0:!1},o=function(o){return n(o)?(e.date=o,e.showing_date=moment(o),t(),e.dateChange()):void 0},e.$watch("date",function(e,t){return e!==t?o(e):void 0}),e.getClass=function(t){var o;return{active:null!=(o=e.date)?o.isSame(t,"day"):void 0,off:!e.showing_date.isSame(t,"month"),available:n(t),invalid:!n(t),highlight:"function"==typeof e.dateHightlight?e.dateHightlight(t):void 0}},(t=function(){var t,n,o,i,r,l,s;for(t=moment(e.showing_date).startOf("month").startOf("week"),i=moment(e.showing_date).endOf("month").endOf("week"),(null!=(r=e.date)&&"function"==typeof r.isValid?r.isValid():void 0)&&(t.set("hour",e.date.get("hour")),t.set("minute",e.date.get("minute")),t.set("second",e.date.get("second"))),e.weeks=[],l=[];;){if(o=t.day(),n=t.date(),0===o){if(e.weeks.length>5)break;s=[],e.weeks.push(s)}s.push({iso_8061:t.format(),day_of_the_month:n,date:moment(t)}),l.push(t.add(1,"day"))}return l})(),e.dateAllowNull||moment.isMoment(e.date)||(e.date=moment()),moment.isMoment(e.date)?(o(e.date),e.showing_date=moment(e.date)):e.showing_date=moment().startOf("day")}}}),angular.module("shift.components.calendar").run(["$templateCache",function(e){e.put("calendar/calendar.html",'<div class="calendar"><table class="table-condensed"><thead><tr><th title="previous month" ng-click="goToPreviousMonth()"><i class="fa fa-chevron-left"></i></th><th><i ng-if="date" title="go to {{ date.format(\'MMMM Do, YYYY\') }}" ng-hide="showing_date.isSame(date, \'month\')" ng-click="goToSelectedDate()" class="fa fa-dot-circle-o"></i></th><th colspan="3" class="month">{{ showing_date.format(\'MMM YYYY\') }}</th><th><i title="Unset date" ng-click="setNull()" ng-if="date &amp;&amp; dateAllowNull" class="fa fa-times"></i></th><th title="next month" ng-click="goToNextMonth()"><i class="fa fa-chevron-right"></i></th></tr><tr><th>Su</th><th>Mo</th><th>Tu</th><th>We</th><th>Th</th><th>Fr</th><th>Sa</th></tr></thead><tbody ng-click="selectDate($event)"><tr ng-repeat="week in weeks track by $index"><td ng-repeat="day in week track by $index" ng-class="getClass(day.date)" data-iso="{{ day.iso_8061 }}">{{ day.day_of_the_month }}</td></tr></tbody></table></div>')}]),angular.module("shift.components.select",["shift.components.selector"]).directive("shiftSelect",["$compile",function(e){return{restrict:"E",transclude:!0,templateUrl:"select/select.html",scope:{options:"=",option:"=",onSelect:"&",onDiscard:"&",placeholder:"@"},link:function(t,n,o,i,r){var l,s,a,c,u,d;return t.show_select=!1,a=angular.element(document.createElement("div")),a.attr({"ng-show":"option","class":"select-option"}),u=angular.element(document.createElement("shift-selector")),u.attr({"ng-show":"show_select",options:"options","on-select":"_onSelect(selected)","on-discard":"_onDiscard(discarded)"}),d=t.$new(),c=t.$new(),r(d,function(e){return u.append(e)}),r(c,function(e){return a.append(e)}),n.children().append(a),n.append(u),e(u)(d),e(a)(c),t._onDiscard=function(e){return t.show_select=!1,t.option=null,t.onDiscard({discarded:e})},t._onSelect=function(e){return t.onSelect({selected:e}),t.option=e,t.show_select=!1},t.show=function(){return t.show_select=!0},s=function(e){return 27===e.which?t.$apply(function(){return t.show_select=!1}):void 0},l=function(e){var o;for(o=e.target;null!=o?o.parentNode:void 0;){if(o===n[0])return;o=o.parentNode}return t.$apply(function(){return t.show_select=!1})},document.addEventListener("click",l),document.addEventListener("keyup",s),t.$on("$destroy",function(){return document.removeEventListener("click",l),document.removeEventListener("keyup",s)})}}}]),angular.module("shift.components.select").run(["$templateCache",function(e){e.put("select/select.html",'<div ng-click="show()" class="select-container"><div ng-if="!option" class="select-option">{{ placeholder }}</div></div>')}]);var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};angular.module("shift.components.sortable",[]).service("shiftSortableService",function(){var e;return e={},{register:function(t,n,o){return null==e[t]&&(e[t]=[]),e[t].push({container:n,scope:o}),e[t]}}}).directive("shiftSortable",["shiftSortableService",function(e){return{restrict:"A",scope:{shiftSortable:"=",shiftSortableChange:"&",shiftSortableAdd:"&",shiftSortableRemove:"&",shiftSortableHandle:"@",shiftSortableNamespace:"@"},link:function(t,n,o){var i,r,l,s,a,c,u,d,h,m,p,f,g,v;return i=n[0],r=null,v=null,a=null,d={},p=document.createElement("div"),p.className="placeholder",t.shiftSortableNamespace&&(g=e.register(t.shiftSortableNamespace,i,t)),l=function(e,t,o){var i,r,l,s,a,h;for(s=e.children[e.children.length-1],h=e.children,l=r=0,a=h.length;a>r;l=++r)if(n=h[l],i=n.getBoundingClientRect(),u(t,o,i))return c(t,o,i)?n:n===s?d:e.children[l+1]},c=function(e,t,n){var o,i;return t-=$(window).scrollTop(),e-=$(window).scrollLeft(),o=e-n.left,i=n.top+n.height-t,i>o/n.width*n.height},u=function(e,t,n){return t-=$(window).scrollTop(),e-=$(window).scrollLeft(),e>n.left&&e<n.right&&t>n.top&&t<n.bottom},s=function(e){var n;if(n=e.target,null!=t.shiftSortableHandle){if(!n.matches(t.shiftSortableHandle))return;for(;n.parentNode!==i;)n=n.parentNode}return e.preventDefault(),indexOf.call(i.children,n)>=0&&(r=n,v=$(r).index(),p.style.width=r.clientWidth+"px",p.style.height=r.clientHeight+"px",r.style.minWidth=$(r).width()+"px",r.style.minHeight=$(r).height()+"px",window.addEventListener("mousemove",h),window.addEventListener("mouseup",f),i.insertBefore(p,r),document.body.appendChild(r),$(r).addClass("dragging"),h(e)),!1},h=function(e){var n,o,l,s;if(e.preventDefault(),r.style.left=e.pageX-10+"px",r.style.top=e.pageY-10+"px",t.shiftSortableNamespace){for(l=[],n=0,o=g.length;o>n;n++)s=g[n],l.push(m(s.container,e));return l}return m(i,e)},m=function(e,t){var n;return u(t.pageX,t.pageY,e.getBoundingClientRect())?(0===e.children.length?e.appendChild(p):(n=l(e,t.pageX,t.pageY),null!=n&&(n===d?e.appendChild(p):n!==a&&(a=n,e.insertBefore(p,n)))),!1):!1},f=function(e){var n,o,l,s,a,c,u,d,m;if(l=$(p).index(),o=p.parentNode,n=o!==i,c=l!==v,$(r).removeClass("dragging"),n||c||o.insertBefore(r,p),o.removeChild(p),r.style.left=p.style.width=r.style.minWidth="",r.style.top=p.style.height=r.style.minHeight="",r=null,window.removeEventListener("mousemove",h),window.removeEventListener("mouseup",f),n){for(u=null,t.$apply(function(){return u=t.shiftSortable.splice(v,1)[0],t.shiftSortableChange(),t.shiftSortableRemove({item:u})}),d=[],s=0,a=g.length;a>s;s++)m=g[s],d.push(m.container===o?m.scope.$apply(function(){return m.scope.shiftSortable.splice(l,0,u),m.scope.shiftSortableChange(),m.scope.shiftSortableAdd({item:u})}):void 0);return d}return c?t.$apply(function(){return u=t.shiftSortable.splice(v,1)[0],t.shiftSortable.splice(l,0,u),t.shiftSortableChange()}):void 0},i.addEventListener("mousedown",s),t.$on("$destroy",function(){return i.removeEventListener("mousedown",s),g?_.remove(g,function(e){return e.scope===t}):void 0})}}}]);var indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};angular.module("shift.components.selector",[]).directive("shiftSelector",["$compile",function(e){var t,n,o;return o=38,t=40,n=13,{restrict:"E",transclude:!0,scope:{options:"=",selected:"=?",onSelect:"&",onDiscard:"&"},link:function(i,r,l,s,a){var c,u,d,h,m,p,f,g;return p=angular.element(document.createElement("div")),p.addClass("select-container"),p.attr({"ng-if":"options.length"}),h=angular.element(document.createElement("div")),h.addClass("select-option"),h.attr({"ng-repeat":"option in options","ng-class":"getClass($index)","ng-click":"toggle($index, $event)","ng-mouseenter":"setPosition($index, $event)"}),a(i,function(e,t){return h.append(e)}),p.append(h),r.append(p),e(p)(i),e(h)(i),i.position=-1,null!=l.multiple&&null==i.selected&&(i.selected=[]),d=function(e){var r,l;if((null!=(l=i.options)?l.length:void 0)&&(r=e.which||e.keyCode,r===o||r===t||r===n))return i.$apply(function(){switch(r){case o:i.position-=1;break;case t:i.position+=1;break;default:i.position>-1&&i.toggle(i.position,e)}return i.position=Math.max(0,i.position),i.position=Math.min(i.options.length-1,i.position),c()}),e.preventDefault(),e.stopPropagation(),!1},c=function(){var e,t,n,o,l,s;return e=r[0].children[0],o=e.children[i.position],l=o.getBoundingClientRect(),t=e.getBoundingClientRect(),s=getComputedStyle(o),l.bottom>t.bottom&&(n=parseInt(s.marginBottom,10),e.scrollTop+=l.bottom-t.bottom+n),l.top<t.top?(n=parseInt(s.marginTop,10),e.scrollTop+=l.top-t.top-n):void 0},u=function(e){return null!=l.multiple?indexOf.call(i.selected,e)>=0:e===i.selected},i.toggle=function(e,t){return t.stopPropagation(),h=i.options[e],u(h)?i.discard(e):i.select(e),!1},i.select=function(e){var t;return i.position=e,t=i.options[i.position],null!=l.multiple?i.selected.push(t):i.selected=t,i.onSelect({selected:t})},i.discard=function(e){var t;return i.position=e,t=i.options[i.position],null!=l.multiple?_.pull(i.selected,t):i.selected=null,i.onDiscard({discarded:t})},m=0,i.setPosition=function(e,t){return t.clientY!==m?(m=t.clientY,i.position=e):void 0},i.getClass=function(e){var t;return{selected:u(null!=(t=i.options)?t[e]:void 0),active:e===i.position}},(f=function(){return document.addEventListener("keydown",d)})(),g=function(){return document.removeEventListener("keydown",d)},i.$on("$destroy",g)}}}]),angular.module("shift.components.time",[]).directive("shiftTime",function(){return{restrict:"E",templateUrl:"time/time.html",scope:{time:"=",timeChange:"&",timeValidator:"="},link:function(e){var t,n,o,i;return o=null,n=function(t){return moment.isMoment(t)&&t.isValid()?null!=e.timeValidator?e.timeValidator(t):!0:!1},i=function(t){return n(t)&&(e.time=t,e.timeChange()),e.time_str=null===e.time?"":e.time.format("h:mm a"),o=e.time_str},e.$watch("time",function(e,t){return e!==t?i(e):void 0}),e.readTime=function(){var n,r,l,s;if(o!==e.time_str)return s=t(e.time_str),n=s[0],r=s[1],l=moment(e.time).set("hour",n).set("minute",r),i(l)},t=function(e){var t,n,o,i,r;return i=/(1[0-2]|0?[1-9])[^ap\d]?([0-5][0-9]|[0-9])?\s?(am|pm|a|p)?/,r=i.exec(e.toLowerCase()),r?(t=r[1]&&parseInt(r[1],10)||0,n=r[2]&&parseInt(r[2],10)||0,"p"===(o=r[3])||"pm"===o?12>t&&(t+=12):12===t&&(t=0),[t,n]):[0,0]},moment.isMoment(e.time)?i(e.time):void 0}}}),angular.module("shift.components.time").run(["$templateCache",function(e){e.put("time/time.html",'<input type="text" ng-model="time_str" placeholder="--:-- pm" ng-blur="readTime()" ng-disabled="!(time &amp;&amp; time.isValid())">')}]),angular.module("shift.components.typeahead",["shift.components.selector"]).directive("shiftTypeahead",["$compile","$filter",function(e,t){return{restrict:"E",transclude:!0,templateUrl:"typeahead/typeahead.html",scope:{source:"=",filterAttribute:"@",selected:"=",onOptionSelect:"&",onOptionDeselect:"&",placeholder:"@",show_options_on_focus:"=showOptionsOnFocus",show_select_menu:"=?showSelectMenu",close_menu_on_esc:"=closeMenuOnEsc"},link:function(n,o,i,r,l){var s,a,c,u,d,h,m,p;return n.options=[],null==n.show_select_menu&&(n.show_select_menu=!1),n.onSelectMultiOption=function(e){return n.onOptionSelect({option:e})},n.onDeselectMultiOption=function(e){return n.onOptionDeselect({option:e})},d=angular.element(document.createElement("shift-selector")),d.attr({"ng-show":"show_select_menu && !selected",options:"options",selected:"selected","on-select":"onSelect(selected)","ng-mousedown":"mouseDown(true)","ng-mouseup":"mouseDown(false)"}),null!=i.multiselect&&d.attr({multiple:"true","on-select":"onSelectMultiOption(selected)","on-discard":"onDeselectMultiOption(discarded)","ng-show":"show_select_menu"}),h=n.$new(),l(h,function(e){return d.append(e)}),o.append(d),e(d)(h),s=function(){var e;return n.query?(e={},e[n.filterAttribute]=n.query,n.options=t("filter")(n.source,e).slice(0,6),n.show_select_menu=!0):n.options=[]},a=!1,n.mouseDown=function(e){return a=e},n.hide=function(e){return a?void 0:n.show_select_menu=!1},n.onFocus=function(e){return n.show_select_menu=!0,n.show_options_on_focus?n.query?s():n.options=n.source:void 0},n.onSelect=function(e){return n.selected=e,n.query=null!=e?e[n.filterAttribute]:void 0},n.$watch("query",function(e,t){var o;if(e!==t)return null==i.multiselect&&n.query!==(null!=(o=n.selected)?o[n.filterAttribute]:void 0)&&(n.selected=null),s()}),c=function(e){var t;return t=e.which||e.keyCode,n.close_menu_on_esc&&27===t&&n.show_select_menu?(e.stopPropagation(),n.$apply(function(){return n.show_select_menu=!1})):void 0},u=function(e){n.show_select_menu&&(o.has(e.target).length||n.$apply(function(){return n.show_select_menu=!1}))},(m=function(){return document.addEventListener("keyup",c),null!=i.multiselect?document.addEventListener("mousedown",u):void 0})(),p=function(){return document.removeEventListener("keyup",c),document.removeEventListener("mousedown",u)},n.$on("$destroy",p)}}}]),angular.module("shift.components.typeahead").run(["$templateCache",function(e){e.put("typeahead/typeahead.html",'<input type="text" ng-blur="hide($event)" ng-class="{\'select-menu-visible\': show_select_menu &amp;&amp; options.length}" ng-focus="onFocus($event)" ng-model="query" placeholder="{{placeholder}}">')}]);
//# sourceMappingURL=shift-components.min.js.map